### Switching

- For two computers (servers) to communicate, they are connected to a switch which contains a network containing the two systems

- To connect servers to a switch, each host requires an interface (physical or virtual depending on the host)

- An interface is the point of interconnection between a server and a private or public cloud

- In Linux, to see the interfaces for the host, we use the <span style="color:red">ip link</span> command

![[srgck-1.png]]

- To connect the server to the network, assign an IP address in the network's available range to the interface using the <span style="color:red">ip addr add</span> command

![[srgck-2.png]]

- Once the links are up and the IP addresses have been assigned, the servers can now communicate with each other through the switch

![[srgck-3.png]]

- A switch can only enable communication within a network
	- This means it can receive packets on a host in the network and deliver them to other host only on the same network

### Routing

- In order for servers to communicate with each other in different networks, they must connect to a router

![[srgck-4.png]]

- A router is an intelligent device that helps connect two (or more) networks together

- Think of a router as another server with many network ports

- Since the router connects multiple separate networks, it gets the same number of IP addresses assigned (which is commonly the second to last address in each network - the last being the broadcast address)

![[srgck-5.png]]

### Gateway

- For one host to know where another host is located on the network in order to send a packet through, as the router is just one of many devices on the network, you must configure a gateway

- If a network was a room, a gateway would be the door to the outside world

- i.e. to the other networks or to the internet

- Servers need to know where the gateway is in order to communicate through it

- To see the existing routing configuration on a server (Linux), run the <span style="color:red">route</span> command
	- This displays the kernel's routing table

![[srgck-6.png]]

- To configure a gateway on one server to reach another server on a different network, use the <span style="color:red">ip route add</span> command and specify which switch can communicate to which route (the IP address for the other network'sÂ  switch on the router)
	- This would need to be configured on each individual host that you want to communicate outside of the network

![[srgck-7.png]]

- To persist routes through the gateway, you must set them in /etc/network-interfaces file as adding routes through the gateway using the <span style="color:red">ip route add</span> command will not make those routes persist across reboots

- To allow the hosts access to the internet, you would take these steps:
	- You connect the router to the internet
	- Then add a new route in the routing table to route all traffic to that route

![[srgck-8.png]]

### Default Gateway

- Use one of the IP addresses (the one from the server accessed most often) as the "default" gateway destination, as there are millions of IP addresses on the internet and you can't remember every IP address to which to connect

- This way, any request to any network outside of your existing network goes to this particular router

![[srgck-9.png]]

- Instead of the word "default", you can also say "0.0.0.0" which mean "any IP destination"

![[srgck-10.png]]

- A 0.0.0.0 entry in the gateway field means that you don't need a gateway;
	- This is, for example, for host communication within the same network

![[srgck-11.png]]

- Let's say you have multiple routers on your network (one for the internet and one for the internal private network), this means you will need to have two separate gateway (routing table) entries for each network
	- One entry for the internal private network and another entry with the "default" gateway for all other networks including public networks

![[srgck-12.png]]

- If you are having issues reaching the internet from your server, looking at the gateway (routing table) is a good place to start troubleshooting

### How to setup a Linux host as a router

- Assume you have three hosts: A, B, and C. Host A is connected to B in one network, and host B is connected to C in another (meaning host B is connected to both networks).
	- Host A has it's own IP address in it's network, host C has it's own IP address in it's network and host B has two IP addresses, one in each.
	- Right now, host C is unreachable from host A
	- For host A to communicate to host C, we need to add a route to host A telling it the gateway to reach host C is on host B by adding a routing table entry
	- This would need to happen in both directions (on both A and C servers)

![[srgck-13.png]]

- In Linux, by default, packets are not forwarded from one interface to the next (for security reasons)

- In order to allow packets to be transferred across networks through a router, you must enable the <span style="color:red">ip forward</span> setting in the <span style="color:red">/proc/sys/net/ipv4</span> directory
	- By default, this value is set to 0
	- After setting this to 1, you will see communication between networks

![[srgck-14.png]]

- Setting the <span style="color:red">ip forward</span> value to 1 in the /proc/sys/net/ipv4 directory does not persist across reboots. It must be modified in the /etc/sysctl.conf file to persist

![[srgck-15.png]]