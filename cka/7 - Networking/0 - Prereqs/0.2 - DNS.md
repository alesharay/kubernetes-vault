- DNS comes in when you want to access a server by name rather than IP address

- To give an IP address a name, you would add an entry to the <span style="color:red">/etc/hosts</span> file
	- Giving the IP address in the first column and the name in second

![[dns-1.png]]

- Whatever is put into the <span style="color:red">/etc/hosts</span> file becomes the source of truth
	- This means that there is no check to confirm that the IP address and name combination in the hosts file is actually valid

- Running the `hostname` command gives the name of the server, this is not necessarily the same name given in the <span style="color:red">/etc/hosts</span> file

![[dns-2.png]]

- The <span style="color:red">/etc/hosts</span> file doesn't just host local server names, it can also host web address urls

![[dns-3.png]]

- You can have as many names as you want for as many servers as you want in the <span style="color:red">/etc/hosts</span> file

- Every time a server is referred to by name, the <span style="color:red">/etc/hosts</span> file is contacted for the IP address

![[dns-4.png]]

- Translating hostnames to IP addresses using something like the <span style="color:red">/etc/hosts</span> file is known as name resolution

- Within a small network, you can get away with the entries in the <span style="color:red">/etc/hosts</span> file but managing these becomes more difficult when the count grows

![[dns-5.png]]

- For a larger count of server and IP address combinations, instead of using the <span style="color:red">/etc/hosts</span> file, we would move all of the entries into a single server that would manage them centrally; this is called the DNS server (nameserver)

- When there is a DNS server created, you point all hosts to look at that server instead of its own <span style="color:red">/etc/hosts</span> file

- To point a host server to a nameserver you would use the <span style="color:red">/etc/resolv.conf</span> file
	- (this is called the DNS resolution configuration file which every server has)

- To point a host server to a nameserver, add an entry to the <span style="color:red">/etc/resolv.conf</span> file
	- Where <span style="color:red">nameserver</span> is in the first column (indicating that we're using a DNS server) and the IP address to the nameserver in the second

![[dns-6.png]]

- Once the nameserver is configured on all hosts, once a host comes across a hostname that it doesn't know, it looks it up from the nameserver

- With the nameserver configuration, if the IP address of any of the servers were to change, just change it in the nameserver and all hosts will resolve to the new name
	- You would no longer need any entries in the <span style="color:red">/etc/hosts</span> file in any of the hosts

- If there is a nameserver setup, you can still have entries in the local <span style="color:red">/etc/hosts</span> file
	- This just means that only your server will be able to access the other server by name

- If there is an entry in both the <span style="color:red">/etc/hosts</span> file and on the nameserver for the same host (with different IP addresses), the <span style="color:red">/etc/hosts</span> file will take priority over the nameserver

- By default, the order of where DNS resolutions are pulled is the /etc/hosts file, then the nameserver, but that order can be changed by editing the <span style="color:red">/etc/nsswitch.conf</span> file

- To change the order of DNS resolutions, change the "hosts" line in the <span style="color:red">/etc/nsswitch.conf</span> file from "files dns" to "dns files"

![[dns-7.png]]

- If you try to access (ping) a server that is in neither the <span style="color:red">/etc/hosts</span> file or the nameserver specified, you will not be able to

![[dns-8.png]]

- To access common DNS names like [www.facebook.com](http://www.facebook.com) or [www.google.com](http://www.google.com), you can add a well known nameserver to your <span style="color:red">/etc/resolv.conf</span> file; 8.8.8.8

![[dns-9.png]]

- The 8.8.8.8 nameserver is available on the internet and is hosted by and knows about all websites on the internet

- You can have multiple nameservers configured on your host, but you will then have to configure that on all the hosts on your network

- You can configure a DNS server to forward any unknown hostnames to the public nameserver on the internet

![[dns-10.png]]

- A name with a www. at the beginning and a .com at the end is called a domain name and it is how IPs translate to names that we can remember on the public internet

- The reason domain names are separated by dots is to group like things together

- The last portion of the domain name (e.g. .com, .net, .edu, .org, etc…) are the top-level domains that represent the intent of the website
	- .com = commercial (general purpose)
	- .net = network
	- .edu = educational organizations
	- .org = non-profit organizations
	- etc…

![[dns-11.png]]

- Looking at the example [www.google.com](http://www.google.com), the dot is the root, that's where everything starts.

- Looking at the example [www.google.com](http://www.google.com), .com is a top-level domain.

- Looking at the example [www.google.com](http://www.google.com), google is the domain name assigned to Google.

- Looking at the example [www.google.com](http://www.google.com), www. Is a subdomain

- Subdomains help in further grouping things together
	- e.g. Google's map service is available under maps.google.com; thus maps is a subdomain
	- e.g. Google's storage service is available under drive.google.com; thus drive is a subdomain

![[dns-12.png]]

- When you try to reach any of the domains names (say mail.google.com) from within the organization, the request first hits the organizations internal DNS server.
	- It doesn't know who mail or Google is so it forwards your request to the internet

- On the internet, the IP address of the server serving mail.google.com may be resolved with the help of multiple DNS servers

- A root DNS server looks at your request and points you to a DNS server serving roots

- A top-level domain looks at your request and forwards you to the domain

- The domain's DNS server provides you the IP address of the server serving the apps applications

- In order to speed up all future results, your organization's DNS server may choose to cache the IP address for a period of time (a few seconds/minutes) that way it doesn't have to go through the entire process again

![[dns-13.png]]

- All subdomains are configured in the domain's internal DNS server

- The reason we discussed all of the different domain levels is to understand another entry in the <span style="color:red">/etc/resolv.conf</span>file
	- Now that we're dealing with full domain names, we can no longer ping using only the subdomain

![[dns-14.png]]

- In order to reference only the subdomain and not the full domain name, you add another entry into the <span style="color:red">/etc/resolv.conf</span>file called a "search" and you give it the domain name minus a subdomain
	- This will automatically get appended to any name that you try to ping

![[dns-15.png]]
	- 
	- Next time you try to ping a subdomain, you will see that the rest of the domain name will be appended

![[dns-16.png]]

- When a <span style="color:red">search</span> is setup in the <span style="color:red">/etc/resolv.conf</span> file, if you ping with the full domain name, your host is smart enough not to append it again
	- This means that this file is idempotent

- You can provide multiple <span style="color:red">search</span> domains on the same line
	- This means if you try and ping web, it will resolve to web.mycompany.com or web.prod.mycompany.com

![[dns-17.png]]

- The way a record is stored in the DNS server is as follows:
	- A Records - IPv4 address to hostnames,
	- AAAA Records - IPv6 address to hostnames,
	- CNAME - mapping one name to another name

![[dns-18.png]]

- As ping may not always be the right tool to test DNS resolution, there are other available tools such as nslookup

- You can use nslookup to query a hostname from a DNS server

![[dns-19.png]]

- nslookup does not consider the entries in the local <span style="color:red">/etc/hosts</span> file

- If you add an entry into the local <span style="color:red">/etc/hosts</span> file and if you try to do an nslookup for that web application, it is not going to find it
	- The entry for your web application has to be present in your DNS server

- nslookup only queries the DNS server

- dig is a tool to test DNS name resolution
	- It returns more details than nslookup in a similar form

![[dns-20.png]]